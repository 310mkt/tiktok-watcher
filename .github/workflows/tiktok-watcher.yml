name: TikTok Watcher

on:
  schedule:
    - cron: "*/10 * * * *"  # 10åˆ†ãŠãã«å®Ÿè¡Œ
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install -r requirements.txt

      # ğŸ”½ å‰å›ã®å®Ÿè¡Œã§ä¿å­˜ã•ã‚ŒãŸ last_posts.json ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      - name: Download last_posts artifact if exists
        uses: actions/download-artifact@v3
        with:
          name: last-posts
          path: .
        continue-on-error: true  # åˆå›å®Ÿè¡Œã§ã¯ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã‚’è¨±å®¹

      # ğŸ”½ main.py ã‚’å®Ÿè¡Œï¼ˆã“ã®ä¸­ã§ last_posts.json ã‚’èª­ã¿æ›¸ãï¼‰
      - name: Run TikTok checker
        run: python main.py
        env:
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}

      # ğŸ”½ å®Ÿè¡Œå¾Œã« last_posts.json ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¿å­˜
      - name: Upload last_posts artifact
        uses: actions/upload-artifact@v3
        with:
          name: last-posts
          path: last_posts.json
